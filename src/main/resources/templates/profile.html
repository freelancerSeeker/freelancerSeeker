<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Works</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!--font-family-->
    <link href="'https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i'"
          rel="stylesheet">

    <!-- title of site -->
    <title>Directory Landing Page</title>

    <!-- For favicon png -->
    <link rel="shortcut icon" type="image/icon" th:href="@{/assets/logo/favicon.png}"/>

    <!--font-awesome.min.css-->
    <link rel="stylesheet" th:href="@{/assets/css/font-awesome.min.css}">

    <!--linear icon css-->
    <link rel="stylesheet" th:href="@{/assets/css/linearicons.css}">

    <!--animate.css-->
    <link rel="stylesheet" th:href="@{/assets/css/animate.css}">

    <!--flaticon.css-->
    <link rel="stylesheet" th:href="@{/assets/css/flaticon.css}">

    <!--slick.css-->
    <link rel="stylesheet" th:href="@{/assets/css/slick.css}">
    <link rel="stylesheet" th:href="@{/assets/css/slick-theme.css}">

    <!--bootstrap.min.css-->
    <link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}">

    <!-- bootsnav -->
    <link rel="stylesheet" th:href="@{/assets/css/bootsnav.css}">

    <!--style.css-->
    <link rel="stylesheet" th:href="@{/assets/css/style.css}">

    <!--responsive.css-->
    <link rel="stylesheet" th:href="@{/assets/css/responsive.css}">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>
<body>
<section th:replace="/fragments/header-nav :: header"></section>
<section id="works" class="works">
    <div class="container">
        <div class="section-header center">

        </div><!--/.section-header-->
        <div class="works-content">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="single-how-works no-bg">
                        <div class="single-how-works-icon">
                            <i class="flaticon-location-on-road"></i>
                        </div>
                        <h2 style="margin-top:10px" th:text="${user.username}"></h2>
                        <div class="row">
                            <form th:action="'/users/' + ${user.id}" id="editProfile" th:method="PUT">
                                <div class="col-md-6 col-sm-3">
                                    <div class="form-group">
                                        <label for="lastName" class="control-label">Last Name:</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="lastName"
                                                   th:value="${user.lastname}" required disabled name="lastname">
                                            <span class="input-group-addon"><i
                                                    class="glyphicon glyphicon-user"></i></span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="firstName">First Name:</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="firstName"
                                                   th:value="${user.firstname}" required disabled name="firstname">
                                            <span class="input-group-addon"><i
                                                    class="glyphicon glyphicon-user"></i></span>
                                        </div>

                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-3">
                                    <div class="form-group">
                                        <label for="email">Email:</label>
                                        <div class="input-group">
                                            <input type="email" class="form-control" id="email" name="email"
                                                   th:value="${user.email}"
                                                   required disabled>
                                            <span class="input-group-addon"><i
                                                    class="glyphicon glyphicon-envelope"></i></span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="description">Description:</label>
                                        <textarea class="form-control" id="description" name="description"
                                                  th:text="${user.description}"
                                                  required disabled></textarea>

                                    </div>
                                </div>
                                <button type="submit" id="editBtn" style="margin-top:20px;"
                                        class="welcome-hero-btn how-work-btn" onclick="enableEditing()">
                                    Edit profile
                                </button>
                            </form>
                        </div>

                    </div>
                </div>
            </div>
                <div class="row">
                    <p>Create Post</p>
                    <form action="/create-post" method="POST">
                        <div class="form-group">
                        <input type="text" placeholder="Subject" name="subject" class="form-control"style="width: 250px;"required />
                        </div>

                        <div class="form-group">
                            <label  style="display: inline-block; width: 10%;">Start Date:</label>
                            <input type="date" placeholder="Start Date" name="startDate" class="form-control" style="display: inline-block; width: 25%; "required />

                            <label  style="display: inline-block; width: 10%;margin-left:20px;">End Date:</label>
                        <input type="date" placeholder="End Date" name="endDate" class="form-control" style="display: inline-block; width: 25%;"/>
                        </div>
                        <div class="form-group">
                            <textarea placeholder="Body" name="body" required class="form-control"></textarea>
                        </div>
                        <div class="form-group">
                        <button type="submit" class="welcome-hero-btn how-work-btn">Create</button>
                        </div>

                    </form>

                </div>
            <div class="row">
                <div th:each="posts :${post}" class="col-md-4 col-sm-6">
                    <div class="single-how-works">

                        <h2 th:text="${posts.subject}"></h2>

                        <p th:text="${posts.body}" style="margin-top:20px"></p>
                        <p th:text="${#dates.format(posts.createdAt, 'yyyy-MM-dd')}"></p>

                        <form th:action="'/posts/' + ${posts.id}" th:method="PUT">
                            <div class="form-group">
                                <label for="subject">Subject:</label>
                                <input type="text" class="form-control" id="subject" name="subject" th:value="${posts.subject}" >
                            </div>
                            <div class="form-group">
                                <label for="body">Body:</label>
                                <textarea class="form-control" id="body" name="body" required th:text="${posts.body}"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="startDate">Start Date:</label>
                                <input type="date" class="form-control" id="startDate" name="startDate" th:value="${#dates.format(posts.startDate, 'yyyy-MM-dd')}" >
                            </div>
                            <div class="form-group">
                                <label for="endDate">End Date:</label>
                                <input type="date" class="form-control" id="endDate" name="endDate" th:value="${#dates.format(posts.endDate, 'yyyy-MM-dd')}" >
                            </div>
                            <button type="submit" class="update-btn welcome-hero-btn how-work-btn ">Update</button>
                        </form>
                        <form th:action="'/posts/delete/' + ${posts.id}" method="post">

                            <input type="hidden" value="DELETE">
                            <button type="button" class="delete-btn welcome-hero-btn how-work-btn ">Delete</button>

                        </form>
                    </div>
                </div>
                </div>

            </divclass>
        </div>
    </div><!--/.container-->

</section>
<script>
    let btn = document.getElementById("editBtn");
  let form = document.getElementById("editProfile")

btn.addEventListener('click', function (e) {
    e.preventDefault();

    if (btn.innerText === "Save Changes") {
        form.submit();
    } else {
        // Add logic to handle enabling editing
        btn.innerText = "Save Changes";
        const inputs = document.querySelectorAll('input, textarea');
        for (const input of inputs) {
            input.removeAttribute('disabled');
        }
    }
});
 let deleteBtns = document.querySelectorAll(".delete-btn");

deleteBtns.forEach(btn => {
  btn.addEventListener('click', function (e) {
    e.preventDefault();

    const form = this.parentElement;
    const url = form.action;

    fetch(url, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json'
      }
    })
    .then(() => {
      window.location.reload();
    })
    .catch(err => {
      console.error(err);
    });
  });
});
let updateForms = document.querySelectorAll(".update-btn");

updateForms.forEach(form => {
  let btn = form.querySelector(".update-btn");

  btn.addEventListener('click', function (e) {
    e.preventDefault();

    const url = form.action;
    const subject = form.querySelector('input[name="subject"]').value;
    const startDate = form.querySelector('input[name="startDate"]').value;
    const endDate = form.querySelector('input[name="endDate"]').value;
    const body = form.querySelector('textarea[name="body"]').value;
    fetch(url, {
      method: 'PUT',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        subject: subject,
        body: body,
        startDate: startDate,
        endDate: endDate
      })
    })
    .then(() => {
      window.location.reload();
    })
    .catch(err => {
      console.error(err);
    });
  });
});
</script>
<script th:src="@{/assets/js/jquery.js}"></script>

<!--modernizr.min.js-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>

<!--bootstrap.min.js-->
<script th:src="@{/assets/js/bootstrap.min.js}"></script>

<!-- bootsnav js -->
<script th:src="@{/assets/js/bootsnav.js}"></script>

<!--feather.min.js-->
<script th:src="@{/assets/js/feather.min.js}"></script>

<!-- counter js -->
<script th:src="@{/assets/js/jquery.counterup.min.js}"></script>
<script th:src="@{/assets/js/waypoints.min.js}"></script>

<!--slick.min.js-->
<script th:src="@{/assets/js/slick.min.js}"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>

<!--Custom JS-->
<script th:src="@{/assets/js/custom.js}"></script>
</body>
</html>